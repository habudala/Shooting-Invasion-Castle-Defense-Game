<!DOCTYPE html>
<html>
<head>
	<title>Shooting Game</title>
	<style>
		#canvas { border:1px solid grey; }
	</style>
	<script>
		
		function initCanvas() {
			var context = document.getElementById("canvas").getContext("2d");
			var cW = context.canvas.width;
			var cH = context.canvas.height;
			var enemies = [
							{"id":"enemy1","x":1020,"y":75,"w":40,"h":20},
							{"id":"enemy2","x":1020,"y":150,"w":40,"h":20},
							{"id":"enemy3","x":1020,"y":225,"w":40,"h":20},
							{"id":"enemy4","x":1120,"y":75,"w":40,"h":20},
							{"id":"enemy5","x":1120,"y":150,"w":40,"h":20},
							{"id":"enemy6","x":1120,"y":225,"w":40,"h":20},
							{"id":"enemy7","x":1220,"y":75,"w":40,"h":20},
							{"id":"enemy8","x":1220,"y":150,"w":40,"h":20},
							{"id":"enemy9","x":1220,"y":225,"w":40,"h":20},

							{"id":"enemy1","x":1620,"y":75,"w":40,"h":20},
							{"id":"enemy2","x":1620,"y":150,"w":40,"h":20},
							{"id":"enemy3","x":1620,"y":225,"w":40,"h":20},
							{"id":"enemy4","x":1720,"y":75,"w":40,"h":20},
							{"id":"enemy5","x":1720,"y":150,"w":40,"h":20},
							{"id":"enemy6","x":1720,"y":225,"w":40,"h":20},
							{"id":"enemy7","x":1820,"y":75,"w":40,"h":20},
							{"id":"enemy8","x":1820,"y":150,"w":40,"h":20},
							{"id":"enemy9","x":1820,"y":225,"w":40,"h":20},

							{"id":"enemy1","x":2220,"y":75,"w":40,"h":20},
							{"id":"enemy2","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy3","x":2420,"y":225,"w":40,"h":20},
							{"id":"enemy4","x":2220,"y":75,"w":40,"h":20},
							{"id":"enemy5","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy6","x":2420,"y":225,"w":40,"h":20},
							{"id":"enemy7","x":2220,"y":75,"w":40,"h":20},
							{"id":"enemy8","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy9","x":2420,"y":225,"w":40,"h":20},
							];


			function renderEnemies () {
				for (var i = 0; i < enemies.length; i++) {
					context.fillStyle = "blue";
					context.fillRect(enemies[i].x -= 0.5, enemies[i].y, enemies[i].w, enemies[i].h);
				}
			}


			function Launcher () {
				this.y = 280;
				this.x = cW * 0.5 -25;
				this.w = 50;
				this.h = 50;
				this.dir;
				this.bg = "orange";
				this.missiles = [];
				this.render = function () {
					if (this.dir == "left") {
						this.x -= 5;
					}else if (this.dir == "right") {
						this.x += 5;
					}
					context.fillStyle =this.bg;
					context.fillRect(this.x,this.y,this.w,this.h);
					for (var i = 0; i < this.missiles.length; i++) {
						var miss = this.missiles[i];
						context.fillStyle = miss.bg;
						context.fillRect(miss.x, miss.y -= 5,miss.w,miss.h);
						this.hitDetect(this.missiles[i],i);
						if(miss.y <= 0) {
							this.missiles.splice(i,1);
						}
					}
					if (enemies.length == 0) {
						clearInterval(animate);
						context.fillStyle = "orange";
						context.font ="italic bold 36px Arial, sans-serif";
						context.fillText("Level Complete",cW * 0.5 -130, 50,300);
					}
				}
				this.hitDetect = function (m,mi) {
					for (var i =0; i < enemies.length; i++) {
						var e = enemies[i];
						if(m.x + m.w >= e.x && m.x <= e.x + e.w && m.y >= e.y && m.y <= e.y + e.h) {
							this.missiles.splice(this.missiles[mi],1);
							enemies.splice(i,1);
							document.getElementById("status").innerHTML = "you destroyed " + e.id;
						}
					}
				}
			}

			var launcher = new Launcher();

			function animate () {
				//context.save();
				context.clearRect(0,0,cW,cH);
				launcher.render();
				renderEnemies();
				//context.restore();
			}

			var timer = setInterval(animate,30);

			var leftBtn = document.getElementById("leftBtn");
			var rightBtn = document.getElementById("rightBtn");
			var fire = document.getElementById("fire");
			leftBtn.addEventListener("mousedown",function(event) {
				launcher.dir = "left";
			});
			leftBtn.addEventListener("mouseup",function(event) {
				launcher.dir = "";
			});

			rightBtn.addEventListener("mousedown",function(event) {
				launcher.dir = "right";
			});
			rightBtn.addEventListener("mouseup",function(event) {
				launcher.dir = "";
			});

			fire.addEventListener("mousedown",function(event) {
				launcher.missiles.push({"x":launcher.x + launcher.w *0.5, "y":launcher.y,"w":3,"h":10,"bg":"red"});
			});
			

		}

		window.addEventListener("load",function(event) {
			initCanvas();
		});

	</script>
</head>
<body>
	<canvas id="canvas" width="1000px" height="450px"></canvas>
	<div>
		<button id="leftBtn">Move left</button>
		<button id="rightBtn">Move right</button>
		<button id="fire">Fire</button>
	</div>
	<h3 id="status"></h3>
</body>
</html>