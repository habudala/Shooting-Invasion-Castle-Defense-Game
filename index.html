<!DOCTYPE html>
<html>
<head>
	<title>Shooting Game</title>
	<style>
		#canvas { border:1px solid grey; }
		#container {margin:auto;
					text-align:center;}

		#buttons {margin:auto;
				  text-align:center;}
		#leftBtn {padding:10px;
				  font-size:15px;}
		#rightBtn {padding:10px;
				  font-size:15px;}
		#fire {padding:10px;
				  font-size:15px;}
	</style>
	<script>

		var hero = new Image();
		hero.src = "images/heroShip.png";
		var enemy = new Image();
		enemy.src = "images/enemyShip.png";
		var bg = new Image();
		bg.src = "images/bg.jpg";

		function initCanvas() {
			var context = document.getElementById("canvas").getContext("2d");
			var cW = context.canvas.width;
			var cH = context.canvas.height;
			var enemies = [
							{"id":"enemy1","x":1020,"y":75,"w":50,"h":30,"clipY":0},
							{"id":"enemy1","x":1020,"y":75,"w":50,"h":30,"clipY":0},
							{"id":"enemy2","x":1020,"y":150,"w":50,"h":30,"clipY":0},
							{"id":"enemy3","x":1020,"y":225,"w":50,"h":30,"clipY":0},
							{"id":"enemy4","x":1120,"y":75,"w":50,"h":30,"clipY":0},
							{"id":"enemy5","x":1120,"y":150,"w":50,"h":30,"clipY":0},
							{"id":"enemy6","x":1120,"y":225,"w":50,"h":30,"clipY":0},
							{"id":"enemy7","x":1220,"y":75,"w":50,"h":30,"clipY":0},
							{"id":"enemy8","x":1220,"y":150,"w":50,"h":30,"clipY":0},
							{"id":"enemy9","x":1220,"y":225,"w":50,"h":30,"clipY":0},

							{"id":"enemy10","x":1620,"y":75,"w":50,"h":30},
							{"id":"enemy11","x":1620,"y":150,"w":50,"h":30},
							{"id":"enemy12","x":1620,"y":225,"w":50,"h":30},
							{"id":"enemy13","x":1720,"y":75,"w":50,"h":30},
							{"id":"enemy14","x":1720,"y":150,"w":50,"h":30},
							{"id":"enemy15","x":1720,"y":225,"w":50,"h":30},
							{"id":"enemy16","x":1820,"y":75,"w":50,"h":30},
							{"id":"enemy17","x":1820,"y":150,"w":50,"h":30},
							{"id":"enemy18","x":1820,"y":225,"w":50,"h":30},

							{"id":"enemy19","x":2220,"y":75,"w":40,"h":20},
							{"id":"enemy20","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy21","x":2420,"y":225,"w":40,"h":20},
							{"id":"enemy22","x":2420,"y":75,"w":40,"h":20},
							{"id":"enemy23","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy24","x":2420,"y":225,"w":40,"h":20},
							{"id":"enemy25","x":2420,"y":75,"w":40,"h":20},
							{"id":"enemy26","x":2320,"y":150,"w":40,"h":20},
							{"id":"enemy27","x":2420,"y":225,"w":40,"h":20},
							];


			function renderEnemies () {
				for (var i = 0; i < enemies.length; i++) {
					//context.fillStyle = "blue";
					//context.fillRect(enemies[i].x -= 0.5, enemies[i].y, enemies[i].w, enemies[i].h);
					context.drawImage(enemy,0,enemies[i].clipY,64,29,enemies[i].x -= 0.5,enemies[i].y,enemies[i].w,enemies[i].h);
					if(enemies[i].clipY < 87) {
						enemies[i].clipY += 29;  console.log("I run too");
					}else{enemies[i].clipY = 0; 
						  }
				}
			}


			function drawBg(){
				context.drawImage(bg,0,0,cW,cH);console.log("hey, and me?");
			}


			function Launcher () {
				this.y = 450;
				this.x = cW * 0.5 -25;
				this.w = 65;
				this.h = 100;
				this.clipX = 0;
				this.dir;
				this.bg = "orange";
				this.missiles = [];
				this.render = function () {
					if (this.dir == "left") {
						this.x -= 5;
					}else if (this.dir == "right") {
						this.x += 5;
					}
					//context.fillStyle =this.bg;
					//context.fillRect(this.x,this.y,this.w,this.h);
					context.drawImage(hero,this.clipX,0,29,64,this.x,this.y,this.w,this.h);
					if(this.clipX < 87) {
						this.clipX += 29;  console.log("I run");
					}else{this.clipX = 29; 
						  }
					
					for (var i = 0; i < this.missiles.length; i++) {
						var miss = this.missiles[i];
						context.fillStyle = miss.bg;
						context.fillRect(miss.x, miss.y -= 5,miss.w,miss.h);
						this.hitDetect(this.missiles[i],i);
						if(miss.y <= 0) {
							this.missiles.splice(i,1);
						}
					}
					if (enemies.length == 0) {
						clearInterval(animate);
						context.fillStyle = "orange";
						context.font ="italic bold 36px Arial, sans-serif";
						context.fillText("The skies are clear thanks to you..You are a hero!",cW * 0.5 -130, 50,300);
					}
				}
				this.hitDetect = function (m,mi) {
					for (var i =0; i < enemies.length; i++) {
						var e = enemies[i];
						if(m.x + m.w >= e.x && m.x <= e.x + e.w && m.y >= e.y && m.y <= e.y + e.h) {
							this.missiles.splice(this.missiles[mi],1);
							enemies.splice(i,1);
							document.getElementById("status").innerHTML = "you destroyed " + e.id;
						}
					}
				}
			}

			var launcher = new Launcher();

			function animate () {
				//context.save();
				context.clearRect(0,0,cW,cH);
				drawBg();
				launcher.render();
				renderEnemies();
				//context.restore();
			}

			var timer = setInterval(animate,60);

			var leftBtn = document.getElementById("leftBtn");
			var rightBtn = document.getElementById("rightBtn");
			var fire = document.getElementById("fire");
			leftBtn.addEventListener("mousedown",function(event) {
				launcher.dir = "left";
			});
			leftBtn.addEventListener("mouseup",function(event) {
				launcher.dir = "";
			});

			rightBtn.addEventListener("mousedown",function(event) {
				launcher.dir = "right";
			});
			rightBtn.addEventListener("mouseup",function(event) {
				launcher.dir = "";
			});

			fire.addEventListener("mousedown",function(event) {
				launcher.missiles.push({"x":launcher.x + launcher.w *0.5, "y":launcher.y,"w":3,"h":10,"bg":"red"});
			});
			

		}

		window.addEventListener("load",function(event) {
			initCanvas();
		});

	</script>
</head>
<body>
	<div id="container">
	<canvas id="canvas" width="1000px" height="550px"></canvas>
	</div>
	<div id="buttons">
		<button id="leftBtn">&#8592;</button>
		<button id="fire">Fire</button>
		<button id="rightBtn">&#8594;</button>
		
	</div>
	<h3 id="status"></h3>
</body>
</html>